<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ght666.aiTools.mapper.UserMapper">

    <!-- 根据用户名查找用户 -->
    <select id="findByUsername" resultType="com.ght666.aiTools.entity.po.User">
        SELECT * FROM user
        WHERE username = #{username} AND status = 1
    </select>

    <!-- 根据邮箱查找用户 -->
    <select id="findByEmail" resultType="com.ght666.aiTools.entity.po.User">
        SELECT * FROM user
        WHERE email = #{email} AND status = 1
    </select>

    <!-- 根据账号ID查找用户 -->
    <select id="findByAccountId" resultType="com.ght666.aiTools.entity.po.User">
        SELECT * FROM user
        WHERE account_id = #{accountId} AND status = 1
    </select>

    <!-- 根据状态查找用户列表 -->
    <select id="findByStatus" resultType="com.ght666.aiTools.entity.po.User">
        SELECT * FROM user
        WHERE status = #{status}
        ORDER BY created_time DESC
    </select>

    <!-- 根据角色查找用户列表 -->
    <select id="findByRole" resultType="com.ght666.aiTools.entity.po.User">
        SELECT * FROM user
        WHERE role = #{role} AND status = 1
        ORDER BY created_time DESC
    </select>

    <!-- 更新用户最后登录时间 -->
    <update id="updateLastLoginTime">
        UPDATE user
        SET last_login_time = #{loginTime}, updated_time = NOW()
        WHERE id = #{userId}
    </update>

    <!-- 批量更新用户状态 -->
    <update id="batchUpdateStatus">
        UPDATE user
        SET status = #{status}, updated_time = NOW()
        WHERE id IN
        <foreach collection="userIds" item="userId" open="(" separator="," close=")">
            #{userId}
        </foreach>
    </update>

    <!-- 复杂查询：根据条件查找用户 -->
    <select id="findUsersByCondition" resultType="com.ght666.aiTools.entity.po.User">
        SELECT * FROM user
        <where>
            <if test="username != null and username != ''">
                AND username LIKE CONCAT('%', #{username}, '%')
            </if>
            <if test="email != null and email != ''">
                AND email LIKE CONCAT('%', #{email}, '%')
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
            <if test="role != null and role != ''">
                AND role = #{role}
            </if>
            <if test="startTime != null">
                AND created_time >= #{startTime}
            </if>
            <if test="endTime != null">
                AND created_time <= #{endTime}
            </if>
        </where>
        ORDER BY created_time DESC
    </select>

</mapper>